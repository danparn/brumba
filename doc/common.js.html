<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: common.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: common.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * Brumba
 * Copyright (c) 2012-2020 Dan Parnete
 *
 * This source code is licensed under the MIT license.
*/

/**
 *  Error codes
 */
export const err = {
  db: -1,				// database not found/opened
  coll: -2,			// collection not found
  unique: -3,		// not unique field
  count: -4,		// count error
  cursor: -5,		// cursor error
  ins: -6,			// insert error
  upd: -7,			// update error
  del: -8,			// delete error
  file: -9,			// file error
  dupl: -10,		// duplicate record
  param: -11,		// wrong parameters
  data: -12,		// wrong data
  gen: -13,			// generic
  srv: -14,			// server
  script: -15,	// script not found
  user: -16,		// user not authenticated
  trig: -17,		// trigger error
  sock: -18			// socket error
}


export let dateFormat = 'dd/mm/yyyy'



/** 
 *  hex24 regular expresion
 */
export const hex24 = new RegExp('^[0-9a-fA-F]{24}$') // check for hex string of 24 chars



/** 
 *  Timezone
 */
export const timezone = () => new Date().getTimezoneOffset() * -60000




/** 
 *   Set decimals
 */
export const decimals = (value, dec) => Number(Math.round(value+'e'+dec)+'e-'+dec)



/** 
 *   Capitalize string
 */
export const strCap = str => (str.charAt(0).toUpperCase() + str.slice(1))



/** 
 *   Split string by separator, trim spaces and eliminates empties
 */
export const strSplit = (str, sep) => {
	if (str &amp;&amp; sep) {
		let list = str.split(sep),
			  i = 0
		while (i &lt; list.length) {
			list[i] = list[i].trim()
			if (list[i].length === 0) {
        list.splice(i, 1)
      } else {
        i += 1
      }
		} 
		return list
	}
	return null
}




/** 
 * Get substring between delimiters
 */
export const strGetBet = (str, from, to, startFrom, include) => {
	if (str &amp;&amp; from &amp;&amp; to) {
		let f = str.indexOf(from, startFrom  || 0)
		let t = str.indexOf(to, f+from.length)
		
		if (f >= 0 &amp;&amp; t > 0) {
			if (include) {
				t += to.length
			} else {
				f += from.length
			}
			return str.substring(f, t)
		}
	}
	return ''
}



/** 
 * Find one of any char in pat
 */
export const strFindAny = (str, pat, start) => {
	if (str &amp;&amp; pat) {
		for (let i=start || 0, len=str.length; i &lt; len; ++i) {
			for (let j=0; j &lt; pat.length; ++j) {
				if (str.charAt(i) === pat.charAt(j)) {
					return i
				}
			}
		}
	}
	return -1
}







/** 
 *   Is empty object?
 */
export const objEmpty = (obj) => {
	for (let key in obj) {
		if(obj.hasOwnProperty(key)) return false
	}
	return true
}



/** 
 *   Pick props of object
 */
export const objPick = (obj, props) => {
  let newobj = {}
  if (obj &amp;&amp; props) {
		// string props
		if (typeof props === 'string') {
	    const propList = strSplit(props, ',')
	    propList.forEach(k => {
	      if (obj[k]) {
					newobj[k] = obj[k]
				}
	    })
		// function
		} else if (typeof props === 'function') {
			for (const k in obj) {
				if (props(k)) {
					newobj[k] = obj[k]
				}
			}
	  }
  }
  return newobj
}



/** 
 *   Pick all properties less then props, recursively
 */
export const objLess = (obj, props) => {
  let newobj = {}
  if (obj &amp;&amp; typeof obj === 'object') {
    const propList = (props) ? props.split(',') : []

    for (let p in obj) {
      if (!propList.includes(p)) {
        if (Array.isArray(obj[p])) {
          newobj[p] = obj[p]
        } else if (obj[p] &amp;&amp; typeof obj[p] === 'object') {
          const op = objLess(obj[p], props)
          if (op !== {}) {
            newobj[p] = op
          }
        } else {
          newobj[p] = obj[p]
        }
      }
    }
  }
  return newobj
}



/** 
 *   Delete props of object
 */
export const objDel = (obj, props) => {
  if (obj &amp;&amp; props) {
    const propList = props.split(',')
    propList.forEach(k => {
      delete obj[k]
    })
  }
}



/** 
 *   Add multilevel prop to object
 */
export const objAddProp = (obj, prop, value, append) => {
  if (obj &amp;&amp; prop &amp;&amp; value) {
    const propTree = prop.split('.')
    let o = obj
    for (let i=0; i &lt; propTree.length; ++i) {
      const p = propTree[i]
      if (i &lt; propTree.length-1) {
        if (!o[p]) {
          o[p] = {}
        }
        o = o[p]
      } else if (o[p]) {
        if (append) {
          o[p] += ' ' + value
        } else {
          o[p] = value
        }
      } else {
        o[p] = value
      }
    }
  }
}



/** 
 *   Object clone
 */
export const objClone = (obj) => {
  if (obj) {
    return JSON.parse(JSON.stringify(obj))
  }
  return obj
}



/** 
 *   Parse string to JSON
 */
export const toJSON = (str) => {
	if (str) {
		let s = str.replace(/'+/g, '"')
		let p = 0
		let i, c
		while (true) {
			p = s.indexOf(':', p)
			if (p &lt; 0) {
				try	{
					return JSON.parse(s)
				} catch (e) {
					console.log(s)
					console.log('toJSON: parse error: ' + e)
					return null
				}
			}
			i = p-1
			do c = s.charAt(i--)
			while (',{"'.indexOf(c) &lt; 0 &amp;&amp; i >= 0)
			if (',{'.indexOf(c) >= 0) {
				s = s.substring(0,i+2) + '"' + s.substring(i+2,p).trim() + '"' + s.substring(p)
			}
			++p 
		}
	}
	return null
}





/** 
 *   Translate string to lang
 */
export const translate = (str, lang) => {
	return str
}




/*
 * Set field values on formula
 */
export const formulaValues = (form, formula) => {
	if (!form || !formula || formula.trim().length === 0) return null
	
	const op = ', *+/-()'
	let b = 0, e = 0, expr = ''
	while (b > -1) {
		b = formula.indexOf('#', b)
		if (b > -1) {
			e = strFindAny(formula, op, b)
			if (e &lt; 0) {
				e = formula.length
			}
			const fname = formula.substring(b,e)
			formula = formula.replace(fname, form[fname.substr(1)] || '0')
			++b
		}
	}
	return formula
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#$">$</a></li><li><a href="global.html#$$">$$</a></li><li><a href="global.html#childIndex">childIndex</a></li><li><a href="global.html#clientScript">clientScript</a></li><li><a href="global.html#createElement">createElement</a></li><li><a href="global.html#decimals">decimals</a></li><li><a href="global.html#e$">e$</a></li><li><a href="global.html#e$$">e$$</a></li><li><a href="global.html#err">err</a></li><li><a href="global.html#hex24">hex24</a></li><li><a href="global.html#inputDate">inputDate</a></li><li><a href="global.html#n$$">n$$</a></li><li><a href="global.html#objAddProp">objAddProp</a></li><li><a href="global.html#objClone">objClone</a></li><li><a href="global.html#objDel">objDel</a></li><li><a href="global.html#objEmpty">objEmpty</a></li><li><a href="global.html#objLess">objLess</a></li><li><a href="global.html#objPick">objPick</a></li><li><a href="global.html#remote">remote</a></li><li><a href="global.html#report">report</a></li><li><a href="global.html#strCap">strCap</a></li><li><a href="global.html#strFindAny">strFindAny</a></li><li><a href="global.html#strGetBet">strGetBet</a></li><li><a href="global.html#strSplit">strSplit</a></li><li><a href="global.html#timezone">timezone</a></li><li><a href="global.html#toJSON">toJSON</a></li><li><a href="global.html#toolsText">toolsText</a></li><li><a href="global.html#translate">translate</a></li><li><a href="global.html#unselect">unselect</a></li><li><a href="global.html#validate">validate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Wed Aug 12 2020 18:58:59 GMT+0300 (Eastern European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
