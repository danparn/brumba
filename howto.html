<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title>Brumba HowTo</title>
	<meta name="generator" content="LibreOffice 6.1.5.2 (Linux)"/>
	<meta name="created" content="00:00:00"/>
	<meta name="changed" content="2020-08-09T19:18:13.235565532"/>
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<style type="text/css">
		@page { size: 21cm 29.7cm; margin-left: 2cm; margin-right: 1cm; margin-top: 1cm; margin-bottom: 1cm }
		p { margin-bottom: 0.25cm; background: transparent; color: #000000; line-height: 115%; background: transparent }
		h2 { margin-top: 0.35cm; margin-bottom: 0.21cm; background: transparent; color: #000000; background: transparent; page-break-after: avoid }
		h2.western { font-family: "Liberation Serif", serif; font-size: 18pt; font-weight: bold }
		h2.cjk { font-family: "Noto Sans CJK SC Regular"; font-size: 18pt; font-weight: bold }
		h2.ctl { font-family: "FreeSans"; font-size: 18pt; font-weight: bold }
		h4 { margin-top: 0.21cm; margin-bottom: 0.21cm; background: transparent; color: #000000; background: transparent; page-break-after: avoid }
		h4.western { font-family: "Liberation Serif", serif; font-size: 12pt; font-weight: bold }
		h4.cjk { font-family: "Noto Sans CJK SC Regular"; font-size: 12pt; font-weight: bold }
		h4.ctl { font-family: "FreeSans"; font-size: 12pt; font-weight: bold }
		code.western { font-family: "Liberation Mono", monospace }
		code.cjk { font-family: "Courier New", monospace }
		code.ctl { font-family: "Liberation Mono", monospace }
		a:link { color: #000080; so-language: zxx; text-decoration: underline }
		a:visited { color: #800000; so-language: zxx; text-decoration: underline }
	</style>
</head>
<body lang="en-US" text="#000000" link="#000080" vlink="#800000" dir="ltr"><h2 class="western" align="center">
Brumba IDE HowTo</h2>
<p align="center" style="margin-bottom: 0cm">by Dan Parnete</p>
<p align="right" style="margin-bottom: 0cm">updated: 1 June 2015</p>
<p><br/>
<br/>

</p>
<p>Run your Brumba server on <a href="https://localhost:3090/">https://localhost:3090</a>
to avoid password annoyance (no user check).<br/>
Open IDE from
<a href="http://localhost:3090/ide">http://localhost:3090/ide</a></p>
<p><b>Save</b>: Use <i>save</i> button in the toolbar. <br/>
<b>Delete</b>:
Use <i>delete</i> button in the toolbar. 
</p>
<p><b>Records list</b>: If the form/page has to display the records
list, use the <i>list</i> toolbar button.</p>
<p><br/>
<br/>

</p>
<h4 class="western">Forms</h4>
<p><b>Create</b>: <i>Tools</i> menu. Write fields names separated by
comma. Field name should not include spaces or special characters,
except underscore. Click <i>New Form</i> or <i>New Grid</i>.
<br/>
<b>Properties</b>: Open it from <i>Properties</i> toolbat
button. Click on form/field/label to see it's properties. <br/>
<b>Container
borders</b>: Use CTRL+B to toggle container borders.<br/>
<b>Select
fields</b>: click on the field, or CTRL+click to toggle selection.
<br/>
<b>Move field</b>: by dragging it on the bottom of the same
container, or in another container. You cam also drop it over another
field to put it on the same row.<br/>
<b>Resize selected field</b>:
SHIFT+arrow left/right keys, or write width % in <i>Properties.</i><br/>
<b>Add
fields</b>: From the <i>Tool</i> menu, write fields names, click the
mouse on the form in position you want to add, then click <i>Add
Fields</i> menu button. For adding just one element, use right click
to the desired position, choose the element to add from the context
menu.<br/>
<b>Events</b>: write form specific code, from toolbar
button.<br/>
<b>CSS</b>: write form specific CSS, from toolbar
button.<br/>
<b>HTML</b>: view/modify form html, from toolbar button.
</p>
<h4 class="western">Pages</h4>
<p><b>Create</b>: <i>Tools / New Page</i> menu. Use <i>Split
horizontal</i> or <i>Split vertical</i> from context menu to divide
in more parts. Use <i>Add column</i> to add more containers
horizontaly. Select container and use SHIFT+arrow left/right to
resize it.<br/>
<b>Set forms</b>: <i>Set form</i> from context menu
on each container. <br/>
<b>Tabs</b>: Context menu <i>Add Tab</i> in
container you want to add tabbed forms. Each tab presents a container
that can be divided further. Right click on tab zone to <i>Add/Remove</i>
tabs. Rename tab from <i>Properties</i>.<br/>
<br/>
<br/>

</p>
<h4 class="western">Reports</h4>
<p><b>Create</b>: <i>Tools / New Report</i> menu. Defaults to
portrait, can switch to landscape from <i>Properties.</i> In report
everything is fixed size, fixed position. Select band with DblClick
and resize with SHIFT+arrow up/down. Add label, field, image from
context menu.<br/>
<b>Group</b>: Add <i>group</i> band from context
menu. <br/>
<b>Move</b>: Move elements with CTRL+arrow.<br/>
<b>Resize</b>:
Resize elements with SHIFT+arrow.<br/>
<b>Multi select</b>:
CTRL+mouse drag over.<br/>
<br/>
<br/>

</p>
<h4 class="western">Menu</h4>
<p><b>Create/Modify</b>: Use <i>Application / MENU</i> menu. The menu
is a simple text, TAB indentation is the level separator. Single
forms are called as <i>forms.FormName</i> , pages as <i>pages.PageName</i>
ex.: 
</p>
<ul>
	<li><p style="margin-bottom: 0cm"><code class="western">“</code><code class="western">Header
	1” </code>
	</p>
	<ul>
		<li><p style="margin-bottom: 0cm"><code class="western">“</code><code class="western">Sub
		level 1” </code>
		</p>
		<ul>
			<li><p style="margin-bottom: 0cm"><code class="western">“</code><code class="western">Item
			1” forms.Form1 </code>
			</p>
			<li><p style="margin-bottom: 0cm"><code class="western">“</code><code class="western">Item
			2” pages.Page2 </code>
			</p>
		</ul>
		<li><p style="margin-bottom: 0cm"><code class="western">“</code><code class="western">Item
		3” forms.Form3 </code>
		</p>
		<li><p style="margin-bottom: 0cm"><code class="western">&quot;Options&quot;
		forms._options:menuid:menusort </code>
		</p>
	</ul>
	<li><p><code class="western">“</code><code class="western">Item 4”
	pages.Page4 </code>
	</p>
</ul>
<p><br/>
<br/>

</p>
<h4 class="western">Forms query</h4>
<p>Query has the format: <br/>
<code class="western">{ coll:
'collectionName', fields: 'field1, field2, …', where: {condition},
sort: {field1: 1, field2:-1} }</code> <br/>
Where condition has the
<a href="http://docs.mongodb.org/manual/reference/operator/query/">MongoDb
find format</a>. Sort 1 is ascending, -1 descending. <br/>
If the
form is the main plain form, <i>query</i> is for the records list. In
this case, <i>fields</i> defines the list columns: <code class="western">fieldName
: width : headerText , …</code> <br/>
If the query has <code class="western">findone:
true </code>option, only one record will be returned.<br/>
A grid
could display an array field of it's master (embedded array in a
document), and the query will be <code class="western">{ field:
'arrayFieldName', reorder: {field1: 1, field2:-1} }</code> (see
<i>Patient_visit</i> form in the demo application), where field could
be ‘level1.level2.level3’ for multilevel embedded array (see
Patient_prescription form).<br/>
A grid could display the
concatenation of an array field for the selected documents, and the
query will be <code class="western">{ concat: 'arrayFieldName', add:
'field1,fields2,...' }</code> (see <i>Patient_all</i> form in the
demo application). Add master fields to each record of the result
with &quot;add&quot; parameter. <br/>
If the form is just an
extension of the main form (record divided in more tabpages), use an
empty query <code class="western">{}</code> (see <i>Patient_address</i>
form in the demo application). 
</p>
<p><br/>
<br/>

</p>
<h4 class="western">Select query</h4>
<p><i>query</i> could be a database query (as for the form) or a JSON
array (fixed options) <br/>
<code class="western">[ {_id:..,
_txt:..}, … ]</code> (see Drugs_form <i>form</i> field in the demo
application). <br/>
<i>Fields</i>: (just for database query) the
first one is the value, the others separated by ' - ' creates the
text. To use just a space as separator, start the field name with '+'
: <code class="western">_id,name,+surname <br/>
</code>To create a
multilevel optgroup like tree structure use <code class="western">group:
true</code> query option, or <code class="western">groupsel: true</code>
if you want a selectable group item. In this case the value field
must use &quot;.&quot; to indicate the tree structure ex.: a, <i>a.1,
a.2, a.2.1, a.2.2, b, b.1, b.2</i> and the data must be ordered by
value field.</p>
<p><br/>
<br/>

</p>
<h4 class="western">Autocomplete query</h4>
<p><i>query</i> could have property <code class="western">extra :
'filed1,field2,...'</code> used for displaying additional readonly
data from the autocomplete collection in the current form. The form
must have this fields set as disable, or at least readonly (see
<i>Prescriptions</i> form in the demo application). <br/>
The
autocomplete field will be saved as an object <code class="western">{val:..,
txt:..}</code>. Any condition on such a field will be
<code class="western">patient_id.val:...</code> 
</p>
<p><br/>
<br/>

</p>
<h4 class="western">References</h4>
<p>References are used for referential integrity, to block delete
operation on documents that have been used as <i>select</i> or
<i>autocomplete</i> in other documents. <br/>
Ex.: for the field
patient_id in the Prescription form should be defined <br/>
<code class="western">FROM
coll: Prescription field: patient_id =&gt; TO coll: Patients</code>
<br/>
TO field: _id is implicit. 
</p>
<p><br/>
<br/>

</p>
<h4 class="western">Run application</h4>
<ul>
	<p style="margin-bottom: 0cm">https://localhost:3000 
	</p>
	<li><p style="margin-bottom: 0cm">Application: yourapp 
	</p>
	<li><p style="margin-bottom: 0cm">Database: yourdb 
	</p>
	<li><p style="margin-bottom: 0cm">User: user 
	</p>
	<li><p>Password: pass 
	</p>
</ul>
<p><br/>
<br/>

</p>
<h4 class="western">Events</h4>
<p>Open events dialog from <i>Events</i> menu. It is always relative
to the current form. <br/>
Brumba defines this form events: <br/>
-
<i>open</i> (on form open, prior to any other event) <br/>
- <i>new</i>
(new button, for some document initialization) <br/>
- <i>save</i>
(before save, to check values or alter form.modif) <br/>
- <i>delete</i>
(before delete, to check and validate) <br/>
- <i>retrieve</i> (after
retrieve, to alter dataset before display) <br/>
- <i>display</i>
(after form display data) <br/>
- <i>rowselected</i> (for tabular
forms) <br/>
An event can return <i>true</i> as a STOP message, to
prevent the normal behavior. Inside the <i>open</i> event you can
write all other component events: 
</p>
<ul>
	<li><p style="margin-bottom: 0cm"><code class="western">var form =
	this </code>
	</p>
	<li><p style="margin-bottom: 0cm"><code class="western">$(form).on(
	'open', function(ev) { </code>
	</p>
	<ul>
		<li><p style="margin-bottom: 0cm"><code class="western">form.tag.find('#fieldName').on('change',
		function(ev) { </code>
		</p>
		<ul>
			<li><p style="margin-bottom: 0cm"><code class="western">console.log(
			$(this).val() ) </code>
			</p>
		</ul>
		<li><p style="margin-bottom: 0cm"><code class="western">}) </code>
		</p>
		<li><p style="margin-bottom: 0cm"><code class="western">form.tag.find('#buttonName').on('click',
		function(ev) { </code>
		</p>
		<ul>
			<li><p style="margin-bottom: 0cm"><code class="western">doSomething()
			</code>
			</p>
		</ul>
		<li><p style="margin-bottom: 0cm"><code class="western">}) </code>
		</p>
	</ul>
	<li><p style="margin-bottom: 0cm"><code class="western">}).on(
	'save', function(ev) { </code>
	</p>
	<ul>
		<li><p style="margin-bottom: 0cm"><code class="western">//
		form.modif is the object that collects all modified fields to save </code>
		</p>
		<li><p style="margin-bottom: 0cm"><code class="western">// add an
		&quot;updated&quot; field that is not inserted by the user </code>
		</p>
		<li><p style="margin-bottom: 0cm"><code class="western">form.modif.updated
		= Date.new() </code>
		</p>
	</ul>
	<li><p><code class="western">}) </code>
	</p>
</ul>
<p><br/>
<br/>

</p>
<h4 class="western">Scripts</h4>
<p>Open it from <i>Scripts</i> menu. It is ready for a new script.
Give it a name and write the cod, then <i>Save</i>. Remember that
only exported functions are visible from outside the module. <br/>
Call
a server function from client with: <br/>
<code class="western">{
cmd: 'SRV', app: 'appName', script: 'scriptName.functionName', args
for the function... }<br/>
</code>Scripts are cached and loaded from
brumba/scripts/appName directory.<br/>
<br/>
Client scripts could be
dynamically loaded with:<br/>
<code class="western">loadScript(scriptName,
callback)</code></p>
<h4 class="western"><br/>
<br/>

</h4>
<h4 class="western">Database triggers</h4>
<p>There is a special server script called <code class="western">triggers</code>.
Here you can define triggers of type: <code class="western">beforeSave,
afterSave, beforeDelete, afterDelete</code> for any collection. The
trigger function must be named <code class="western">collection_triggerName</code>.
Example of <code class="western">beforeSave</code> on Prescriptions
collection:</p>
<p style="margin-left: 1.07cm; margin-bottom: 0cm"><code class="western">var
U = require('../../util')<br/>
<br/>
exports.Prescriptions_beforeSave
= function( par, callback, data ) {<br/>
&nbsp;&nbsp;&nbsp; ...<br/>
&nbsp;&nbsp;&nbsp;
callback({err: U.err.trig})<br/>
}</code></p>
<p style="margin-bottom: 0cm"><br/>
If a <code class="western">before</code>
trigger returns <code class="western">{err: U.err.trig}</code> the
transaction will be blocked. <br/>
<code class="western">after</code>
triggers will receive the transaction result in <code class="western">par.res</code>
and the original state of the modified data in <code class="western">par.before</code></p>
</body>
</html>